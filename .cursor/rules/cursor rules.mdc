---
description: 
globs: 
alwaysApply: false
---
# Proces Deploymentu ChatHeroes

## âš ï¸ WaÅ¼ne Informacje

**Ograniczenia i Wnioski**:
- Command chaining (`cd client && npm run build`) NIE DZIAÅA na Windows
- KaÅ¼dÄ… komendÄ™ naleÅ¼y wykonywaÄ‡ osobno w odpowiednim folderze
- Zawsze sprawdÅº czy masz zainstalowane wymagane narzÄ™dzia (Docker, Vercel CLI, Railway CLI) przed rozpoczÄ™ciem
- Monitoruj logi podczas deploymentu - zawierajÄ… cenne informacje diagnostyczne
- ZwrÃ³Ä‡ uwagÄ™ na ostrzeÅ¼enia npm podczas instalacji zaleÅ¼noÅ›ci

## ðŸŒ Åšrodowiska Deploymentu

### Production
- **Frontend (Vercel)**
  - URL: `client-phi-eight-74.vercel.app`
  - Zmienne Å›rodowiskowe:
    ```
    VITE_API_URL=https://backendchatheroes2-production.up.railway.app/api
    VITE_WS_URL=wss://backendchatheroes2-production.up.railway.app
    ```
  - Deployment: `vercel --prod`

- **Backend (Railway)**
  - URL: `backendchatheroes2-production.up.railway.app`
  - Projekt: "production"
  - Zmienne Å›rodowiskowe:
    ```
    NODE_ENV=production
    FRONTEND_URL=https://client-phi-eight-74.vercel.app
    ```
  - Deployment: `railway up`

### Staging
- **Frontend (Vercel)**
  - URL: `client-[hash]-kosmicznynomads-projects.vercel.app`
  - Zmienne Å›rodowiskowe:
    ```
    VITE_API_URL=https://[STAGING_BACKEND_URL]/api
    VITE_WS_URL=wss://[STAGING_BACKEND_URL]
    ```
  - Deployment: `vercel`

- **Backend (Railway)**
  - Projekt: "staging"
  - Serwis: "staging-backend"
  - Zmienne Å›rodowiskowe:
    ```
    NODE_ENV=staging
    FRONTEND_URL=https://client-[hash]-kosmicznynomads-projects.vercel.app
    ```
  - Deployment: `railway up`

## ðŸ” Checklist Przed Deploymentem

1. **Wymagane NarzÄ™dzia**:
   - [ ] Vercel CLI (`npm i -g vercel`)
   - [ ] Railway CLI (`npm i -g @railway/cli`)
   - [ ] Docker (opcjonalnie, dla testÃ³w lokalnych)
   - [ ] Node.js i npm

2. **Konfiguracja**:
   - [ ] SprawdÅº zmienne Å›rodowiskowe w `.env.production`
   - [ ] Upewnij siÄ™, Å¼e `config.js` poprawnie obsÅ‚uguje URL-e produkcyjne
   - [ ] Zweryfikuj CORS settings w backendzie

## ðŸ› ï¸ Komendy Deploymentu

### Frontend (Vercel)
```bash
# NIE UÅ»YWAJ: cd client && vercel deploy

# ZAMIAST TEGO:
cd client
vercel deploy
# lub
vercel --prod  # bezpoÅ›rednio na produkcjÄ™

# Dla preview:
vercel
```

### Backend (Railway)
```bash
# NIE UÅ»YWAJ: cd server && railway up

# ZAMIAST TEGO:
cd server
railway up
# lub
railway deploy
```

### Lokalne Uruchomienie
```bash
# NIE UÅ»YWAJ: cd client && npm run dev

# ZAMIAST TEGO:
# Terminal 1:
cd client
npm run dev

# Terminal 2:
cd server
npm run dev
```

## ðŸŒ Aktualne Adresy

**Frontend (Vercel)**:
- GÅ‚Ã³wny: `client-phi-eight-74.vercel.app`
- Development: `client-mcx5k1mzf-kosmicznynomads-projects.vercel.app`

**Backend (Railway)**:
- Publiczny: `backendchatheroes2-production.up.railway.app`
- WewnÄ™trzny: `backendchatheroes2.railway.internal`

## ðŸ—ï¸ Struktura Projektu

```
/
â”œâ”€â”€ client/                 # Frontend (Vercel)
â”‚   â”œâ”€â”€ .env.development    # Lokalny development
â”‚   â”œâ”€â”€ .env.production     # Produkcja
â”‚   â”œâ”€â”€ vite.config.js      # Konfiguracja proxy
â”‚   â”œâ”€â”€ vercel.json        # Konfiguracja Vercel
â”‚   â”œâ”€â”€ package.json       # ZaleÅ¼noÅ›ci i skrypty
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ config.js      # Konfiguracja API
â””â”€â”€ server/                # Backend (Railway)
    â”œâ”€â”€ .env              # Zmienne Å›rodowiskowe
    â”œâ”€â”€ app.js           # GÅ‚Ã³wna aplikacja
    â”œâ”€â”€ package.json     # ZaleÅ¼noÅ›ci i skrypty
    â”œâ”€â”€ docker-compose.yml # Konfiguracja lokalna
    â””â”€â”€ Dockerfile       # Konteneryzacja
```

## ðŸš€ Proces Deploymentu

### Deployment na Staging
1. **Backend (Railway)**
   ```bash
   cd server
   railway link  # wybierz projekt "staging"
   railway up
   ```
   - Skopiuj URL backendu po deploymencie

2. **Frontend (Vercel)**
   ```bash
   cd client
   vercel
   ```
   - Skopiuj URL frontendu po deploymencie

3. **Aktualizacja zmiennych**
   - W Railway Dashboard:
     - Projekt "staging"
     - Ustaw `FRONTEND_URL` na URL frontendu
   - W Vercel Dashboard:
     - Environment Variables
     - Ustaw `VITE_API_URL` i `VITE_WS_URL` dla Preview/Development

### Deployment na Production
1. **Backend (Railway)**
   ```bash
   cd server
   railway link  # wybierz projekt "production"
   railway up
   ```

2. **Frontend (Vercel)**
   ```bash
   cd client
   vercel --prod
   ```

3. **Aktualizacja zmiennych**
   - W Railway Dashboard:
     - Projekt "production"
     - Ustaw `FRONTEND_URL` na URL produkcyjny
   - W Vercel Dashboard:
     - SprawdÅº zmienne produkcyjne

## ðŸ” Weryfikacja Deploymentu

### Staging
1. SprawdÅº health endpoint:
   ```bash
   curl https://[STAGING_BACKEND_URL]/health
   ```
2. OtwÃ³rz frontend w przeglÄ…darce
3. Przetestuj funkcjonalnoÅ›ci
4. SprawdÅº logi w Railway i Vercel Dashboard

### Production
1. SprawdÅº health endpoint:
   ```bash
   curl https://backendchatheroes2-production.up.railway.app/health
   ```
2. OtwÃ³rz frontend w przeglÄ…darce
3. Zweryfikuj krytyczne funkcjonalnoÅ›ci
4. Monitoruj logi produkcyjne

## ðŸ”„ Proces Developmentu

1. **Lokalne uruchomienie**:
   ```bash
   # Terminal 1 (client)
   cd client
   npm run dev    # http://localhost:3000

   # Terminal 2 (server)
   cd server
   npm run dev    # http://localhost:3001
   ```

2. **Testowanie endpointÃ³w**:
   ```bash
   # Test backendu
   curl http://localhost:3001/health
   curl http://localhost:3001/api/test
   curl http://localhost:3001/api/user/profile  # Test autoryzacji

   # Test produkcji
   curl https://backendchatheroes2-production.up.railway.app/health
   curl https://backendchatheroes2-production.up.railway.app/api/test

   # Test WordPress
   curl https://backendchatheroes2-production.up.railway.app/api/auth/check-subscription

   # Test WebSocket
   wscat -c wss://backendchatheroes2-production.up.railway.app
   ```

## ðŸ”’ CORS i BezpieczeÅ„stwo

1. **Dozwolone domeny**:
   - `client-phi-eight-74.vercel.app`
   - `client-mcx5k1mzf-kosmicznynomads-projects.vercel.app`
   - `*.vercel.app`
   - `localhost`
   - `127.0.0.1`

2. **Headers**:
   - `Content-Type`
   - `Authorization`
   - `X-Requested-With`
   - `Accept`
   - `Origin`

## ðŸ” Monitoring

1. **Vercel Dashboard**:
   - Status deploymentu
   - Logi
   - Metryki

2. **Railway Dashboard**:
   - Logi kontenerÃ³w
   - UÅ¼ycie zasobÃ³w
   - Status deploymentu

3. **MongoDB Atlas**:
   - Monitoring bazy
   - Metryki wydajnoÅ›ci
   - Alerty

## âš ï¸ RozwiÄ…zywanie ProblemÃ³w

1. **CORS BÅ‚Ä™dy**:
   - SprawdÅº origin w `app.js`
   - Zweryfikuj headers
   - SprawdÅº proxy w `vite.config.js`

2. **Autoryzacja**:
   - SprawdÅº JWT token
   - Zweryfikuj WordPress integracjÄ™
   - SprawdÅº wygasanie tokenÃ³w

3. **Deployment BÅ‚Ä™dy**:
   - SprawdÅº zmienne Å›rodowiskowe
   - Zweryfikuj logi
   - SprawdÅº build procesy

## ðŸ“ Checklist Deploymentu

1. **Przed Deploymentem**:
   - [ ] Test buildu lokalnie
   - [ ] SprawdÅº zmienne Å›rodowiskowe
   - [ ] Test endpointÃ³w lokalnie

2. **Po Deploymencie**:
   - [ ] SprawdÅº status na Vercel/Railway
   - [ ] Test endpointÃ³w produkcyjnych
   - [ ] SprawdÅº logi
   - [ ] Test integracji frontend-backend

## ðŸ”„ Rollback

1. **Vercel**:
   - UÅ¼yj dashboardu do rollbacku do poprzedniej wersji
   - Lub: `git revert` i push

2. **Railway**:
   - UÅ¼yj dashboardu do rollbacku
   - Lub: przywrÃ³Ä‡ poprzedni tag Dockera 

## ðŸš¨ Znane Problemy i RozwiÄ…zania

1. **URL Handling**:
   ```javascript
   // PrzykÅ‚ad poprawnej obsÅ‚ugi URL w config.js
   const ensureValidUrl = (url) => {
     if (!url) return defaultUrl;
     url = url.trim();
     if (!url.startsWith('http')) url = 'https://' + url;
     return url;
   };
   ```

2. **Windows-Specific**:
   ```powershell
   # âŒ NIE RÃ“B TEGO na Windows:
   cd client && npm run build

   # âœ… ZAMIAST TEGO:
   cd client
   npm run build
   ```

3. **Deployment Verification**:
   ```bash
   # SprawdÅº health endpoint
   curl https://backendchatheroes2-production.up.railway.app/health
   
   # SprawdÅº logi
   railway logs
   ```

## ðŸ“Š Monitoring Deploymentu

1. **Co MonitorowaÄ‡**:
   - Status health endpointu
   - Logi aplikacji
   - OstrzeÅ¼enia npm/build
   - CORS bÅ‚Ä™dy w konsoli przeglÄ…darki
   - PoÅ‚Ä…czenie WebSocket
   - Odpowiedzi API

2. **Gdzie SzukaÄ‡ ProblemÃ³w**:
   - Railway Dashboard -> Logi
   - Vercel Dashboard -> Deployments
   - Browser DevTools -> Network, Console
   - MongoDB Atlas -> Monitoring 